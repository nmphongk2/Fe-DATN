import{r as s,g as j,j as t}from"./index-B8WTsAS6.js";import{u as N}from"./index.esm-CH-ucXk-.js";import{b as q,c as I,d as w}from"./crudInventory.service-Fap8qfeP.js";import{Q as P}from"./react-toastify.esm-BnAFxftJ.js";/* empty css                      */import{n as T}from"./success-DkzG9fZq.js";import{R as A,b as V}from"./ReusableBreadcrumb-D5trGug1.js";import"./clsx-B-dksMZM.js";const E=()=>{var h,p;const{register:d,handleSubmit:y,formState:{errors:o}}=N();s.useState(null),s.useState(!0);const[,c]=s.useState(null),x=j(),[u,b]=s.useState([]),[n,m]=s.useState(null),[i,g]=s.useState(!1),f=r=>{r.currentTarget.value=r.currentTarget.value.replace(/[^0-9]/g,"")},k=r=>{const e=r.clipboardData.getData("Text");/^\d+$/.test(e)||r.preventDefault()},v=async r=>{const e=r.target.value;if(e)try{const a=await q(e);m(a)}catch(a){c(a.message)}else m(null)};s.useEffect(()=>{(async()=>{try{const e=await I();console.log("Fetched products:",e),b(e.productsInInventory||[])}catch(e){console.error("Error fetching products:",e)}})()},[]);const S=async r=>{if(!i){g(!0);try{if(!n){c("Vui lòng chọn một sản phẩm hợp lệ.");return}if(r.quantity>n.quantityStock){c("Số lượng nhập lên kệ vượt quá số lượng tồn kho.");return}const e={productAuction:r.productAuction,quantity:r.quantity};await w(e),T(),setTimeout(()=>{x("/admin/listInventoryV2")},2e3)}catch(e){console.error("Error:",e),c("Đã xảy ra lỗi khi thêm lô hàng. Vui lòng thử lại.")}finally{setTimeout(()=>{g(!1)},3e3)}}};return t.jsxs("form",{onSubmit:y(S),encType:"multipart/form-data",children:[t.jsx(P,{}),t.jsx(A,{items:V.addInventoryV2}),t.jsx("div",{className:"mb-4 ml-4 col-span-full xl:mb-2",children:t.jsx("h1",{className:"text-xl font-semibold text-gray-900 sm:text-2xl dark:text-white",children:"Cập nhật kho hàng đấu giá"})}),t.jsx("div",{className:" px-4 pt-4 xl:grid-cols-[1fr_2fr] xl:gap-4 dark:bg-gray-900",children:t.jsx("div",{className:"col-span-full xl:col-auto",children:t.jsxs("div",{className:"p-4 mb-4 bg-white border border-gray-200 rounded-lg shadow-sm 2xl:col-span-2 dark:border-gray-700 sm:p-6 dark:bg-gray-800",children:[t.jsx("h3",{className:"mb-4 text-xl font-semibold dark:text-white",children:"Tổng quan cập nhật"}),t.jsxs("div",{className:"grid grid-cols-6 gap-6",children:[t.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[t.jsx("label",{htmlFor:"first-name",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Tên sản phẩm"}),t.jsxs("select",{id:"productAuction",className:"bg-gray-50 border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",...d("productAuction",{required:"Sản phẩm không được bỏ trống"}),onChange:v,children:[t.jsx("option",{value:"",children:"Chọn sản phẩm"}),u.length>0?u.map((r,e)=>t.jsx("option",{value:r._id,children:r.product_name},r._id||e)):t.jsx("option",{disabled:!0,children:"Không có sản phẩm nào"})]}),o.productAuction&&t.jsx("span",{className:"text-red-500 text-xs italic",children:(h=o.productAuction.message)==null?void 0:h.toString()})]}),t.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[t.jsx("label",{htmlFor:"quantity",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Số lượng kệ"}),t.jsx("input",{className:"shadow-sm bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",id:"quantity",type:"text",...d("quantity",{required:"Số lượng không được bỏ trống",valueAsNumber:!0,validate:r=>{if(console.log("Validating quantity:",r),console.log("selectedProductInventory:",n),!n)return"Vui lòng chọn sản phẩm trước.";const e=n.quantityShelf||0,a=30,l=n.quantityStock||0;return e>=a?`Kệ đã đạt sức chứa tối đa (${a}). Không thể thêm sản phẩm.`:e+r>a?`Số lượng vượt quá sức chứa của kệ. Tối đa có thể thêm: ${a-e}`:r>l?`Số lượng nhập lên kệ vượt quá số lượng tồn kho. Tối đa có thể thêm: ${l}`:r<=0?"Số lượng phải là số dương":!0}}),onInput:f,onPaste:k}),o.quantity&&t.jsx("span",{className:"text-red-500 text-xs italic",children:(p=o.quantity.message)==null?void 0:p.toString()})]})]}),t.jsx("div",{className:"col-span-6 sm:col-full mt-3",children:t.jsx("button",{type:"submit",className:"text-white bg-blue-600 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800",disabled:i,children:i?"Đang xử lý...":"Cập nhật"})})]})})})]})},B=()=>t.jsx(E,{});export{B as default};
