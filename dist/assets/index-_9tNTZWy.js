import{r as i,g as T,j as r,cV as E}from"./index-B8WTsAS6.js";import{i as R,j as A,r as D}from"./comment.service-DYZbsvXR.js";import{S as L}from"./sweetalert2.all-CanRnygg.js";import{P as I}from"./paginationcrud-CYiMZm9R.js";import{w as K}from"./sweetalert2-react-content.es-_20BSG7l.js";/* empty css                      *//* empty css                */import{t as H,a as O,b as n,c as X,d as $,e as l}from"./chunk-YRZGWF2W-CXxVUGNa.js";import{R as q,b as F}from"./ReusableBreadcrumb-D5trGug1.js";import"./clsx-B-dksMZM.js";import"./chunk-N2KXC5ZE-mxrXGXiM.js";import"./chunk-XHQUSKIE-BwnSvnTo.js";import"./_class_private_field_set-DiTYLpP0.js";import"./filterDOMProps-B3AneKiX.js";import"./useEffectEvent-Cg1JSw20.js";import"./getChildNodes-Cw4ook6e.js";import"./VisuallyHidden-D5xcTfY7.js";import"./useFocusWithin-Cnv4cfRz.js";import"./focusSafely-7dc_zii7.js";import"./useFocusable-BgsBLUcz.js";import"./useFocus-CiKVCmpT.js";import"./FocusScope-DCO5JZf9.js";import"./chunk-KBN3H6OQ-BYj_qRg-.js";import"./index-DiNnCp_7.js";import"./chunk-CAFRINWI-BTDo8zfp.js";import"./useFormValidationState-Ds8IGnmn.js";import"./useFormReset-BlmLPiDA.js";import"./chunk-CIZQCQPA-BQKhqm3c.js";import"./chunk-IXXDDLGU-D8Ib2K6T.js";import"./chunk-7F3ZLNJ6-B2JTPL8n.js";const c=K(L),U=()=>{const[d,p]=i.useState([]),[m,j]=i.useState({}),[h,y]=i.useState(1),[w,C]=i.useState(1),g=T(),k=async e=>{try{const t=await E(e);if(t&&t.product){const{product_name:s,product_price:a,image:o}=t.product;j(u=>({...u,[e]:{name:s,price:a,image:o||[]}}))}else console.error("No product found for this ID.")}catch(t){console.error("Error fetching product:",t)}},f=async e=>{try{const t=await R(e,5);if(!t||!t.comments){console.error("No comments data found in the response."),p([]);return}const s=Array.isArray(t.comments)?t.comments:[];if(p(s),t.totalPages?C(t.totalPages):console.warn("Total pages not found in the response."),s.length>0){const a=s.map(o=>o.id_product);await Promise.all(a.map(async o=>{try{await k(o)}catch(u){console.error(`Error fetching product with id: ${o}`,u)}}))}else console.warn("No comments found in the response.")}catch(t){console.error("Error fetching comments:",t)}},N=async(e,t)=>{c.fire({title:"Xóa vĩnh viễn",text:"Bình luận này sẽ không được khôi phục  ",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Có",cancelButtonText:"Hủy"}).then(async s=>{if(s.isConfirmed)try{await A(e,t),p(a=>a.filter(o=>o._id!==t)),c.fire({title:"Đã xóa!",text:"Bình luận đã được xóa",icon:"success",confirmButtonText:"OK",showConfirmButton:!0,confirmButtonColor:"#3085d6"}),await f(h)}catch(a){console.error("Error deleting comment:",a),c.fire({title:"Lỗi!",text:"Đã xảy ra sự cố khi xóa bình luận.",icon:"error"})}})},_=async e=>{c.fire({title:"Khôi phục bình luận?",text:"Bạn có chắc muốn khôi phục bình luận này không!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Có",cancelButtonText:"Hủy"}).then(async t=>{if(t.isConfirmed)try{await D(e),p(s=>s.filter(a=>a._id!==e)),c.fire({title:"Đã khôi phục!",text:"Đã khôi phục bình luận",icon:"success",confirmButtonText:"OK",showConfirmButton:!0,confirmButtonColor:"#3085d6"}),await f(h)}catch(s){console.error("Error restoring comment:",s),c.fire({title:"Lỗi!",text:"Đã xảy ra sự cố khi khôi phục bình luận.",icon:"error"})}})},B=e=>{y(e),g(`?page=${e}`)};i.useEffect(()=>{const t=new URLSearchParams(location.search).get("page");t?y(parseInt(t,10)):g("?page=1",{replace:!0})},[location.search,g]),i.useEffect(()=>{f(h)},[h]);const[x,b]=i.useState([]),v=e=>{b(e?d.map(t=>t._id):[])},P=e=>{b(t=>t.includes(e)?t.filter(s=>s!==e):[...t,e])},S=e=>{alert(`${e}`)};return r.jsxs(r.Fragment,{children:[r.jsxs(H,{"aria-label":"Example static collection table",children:[r.jsxs(O,{children:[r.jsx(n,{children:r.jsx("input",{type:"checkbox",onChange:e=>v(e.target.checked),checked:x.length===d.length&&d.length>0})}),r.jsx(n,{children:"STT"}),r.jsx(n,{children:"Tên sản phẩm"}),r.jsx(n,{children:"Hình ảnh"}),r.jsx(n,{children:"Nội dung bình luận"}),r.jsx(n,{children:" Đánh giá"}),r.jsx(n,{children:"#"})]}),r.jsx(X,{children:d.map((e,t)=>{var s,a;return r.jsxs($,{className:"border-b text-left dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700",children:[r.jsx(l,{className:"px-4 py-3",children:r.jsx("input",{type:"checkbox",value:e==null?void 0:e._id,checked:x.includes(e==null?void 0:e._id),onChange:()=>P(e==null?void 0:e._id)})}),r.jsx(l,{className:"px-4 py-3",children:t+1}),r.jsx(l,{className:"px-4 py-3",children:((s=m[e==null?void 0:e.id_product])==null?void 0:s.name)||"Loading..."}),r.jsx(l,{className:"px-4 py-3",children:r.jsx("img",{src:(a=m[e==null?void 0:e.id_product])==null?void 0:a.image[0],width:100,height:50})}),r.jsx(l,{className:"px-4 py-3",children:e==null?void 0:e.content}),r.jsx(l,{className:"px-4 py-3 text-sm text-yellow-400",children:Array.from({length:e==null?void 0:e.rating},(o,u)=>r.jsx("span",{children:r.jsx("i",{className:"fa-solid fa-star"})},u))}),r.jsx(l,{className:"px-4 py-3 ",children:r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("button",{type:"button",className:"flex items-center text-red-700 bg-red-200 hover:text-white border border-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-3 py-2 text-center dark:border-red-500 dark:text-red-500 dark:hover:text-white dark:hover:bg-red-600 dark:focus:ring-red-900",onClick:()=>N(e==null?void 0:e.id_product,e==null?void 0:e._id),children:"Xoá"}),r.jsx("button",{className:"py-2 px-3 flex items-center text-sm font-medium text-center text-white bg-lime-600 rounded-lg hover:bg-lime-500 focus:ring-4 focus:outline-none focus:ring-primary-300 dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800",onClick:()=>_(e==null?void 0:e._id),children:"Khôi phục"})]})})]},e==null?void 0:e._id)})})]}),r.jsx("div",{className:"mt-4",children:r.jsx("button",{className:"bg-red-600 text-white py-2 px-4 rounded",onClick:()=>S(x),disabled:x.length===0,children:"Xóa tất cả đã chọn"})}),d.length>0&&r.jsx(I,{currentPage:h,totalPages:w,onPageChange:B})]})},we=()=>r.jsxs("div",{children:[r.jsx(q,{items:F.recycleBin}),r.jsx("div",{className:"mb-4 ml-4 col-span-full xl:mb-2",children:r.jsx("h1",{className:"text-xl font-semibold text-gray-900 sm:text-2xl dark:text-white",children:"Danh sách đánh giá"})}),r.jsx("section",{className:"bg-gray-50 dark:bg-gray-900 p-3 sm:p-5 antialiased",children:r.jsx("div",{className:"mb-4 col-span-full xl:mb-2",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 relative shadow-md sm:rounded-lg overflow-hidden",children:[r.jsx(U,{}),r.jsx("div",{className:"overflow-x-auto"})]})})})]});export{we as default};
