import{r as o,z as A,g as I,B as K,j as r,R as O}from"./index-B8WTsAS6.js";import{f as q,g as H,s as U,h as z,p as G}from"./comment.service-DYZbsvXR.js";/* empty css                */import{S as M}from"./sweetalert2.all-CanRnygg.js";import{w as Q}from"./sweetalert2-react-content.es-_20BSG7l.js";/* empty css                    */import{n as $}from"./success-DkzG9fZq.js";import{u as m}from"./index.esm-CH-ucXk-.js";import{P as J}from"./paginationcrud-CYiMZm9R.js";import{R as V,b as W}from"./ReusableBreadcrumb-D5trGug1.js";import{S as Y}from"./searchFomProduct-CtepxUMW.js";/* empty css                      */import{Q as Z}from"./react-toastify.esm-BnAFxftJ.js";import"./clsx-B-dksMZM.js";const c=Q(M),ee=()=>{const[l,g]=o.useState([]),{id:x}=A(),[C,y]=o.useState(null),[j,f]=o.useState({}),[p,w]=o.useState({}),u=I(),{reset:_}=m(),N=K(),[h,v]=o.useState(1),[P,S]=o.useState(1);o.useEffect(()=>{const t=new URLSearchParams(N.search).get("page");t?v(parseInt(t,10)):u("?page=1",{replace:!0})},[N.search,u]);const R=e=>{v(e),u(`?page=${e}`)},b=async e=>{if(!x){console.log("No product ID provided");return}try{const t=await q(x,e,5),a=t!=null&&t.data&&Array.isArray(t.data)?t.data:[];S(t.totalPages),g(a)}catch(t){console.error("Error fetching data:",t)}},k=async e=>{if(!e){console.log("No comment ID provided");return}try{const t=await H(e);w(a=>({...a,[e]:t||[]}))}catch{return}},E=async e=>{if(!x||!e){console.log("No product ID or comment ID provided"),u("/admin/listComments");return}try{if((await c.fire({title:"Xóa bình luận?",text:"Bạn có chắc muốn xóa bình luận này không!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Xóa!",cancelButtonText:"Hủy"})).isConfirmed)try{await U(e),g(a=>a.filter(n=>n._id!==e)),b(h),c.fire({title:"Đã Xóa!",text:"Bình luận đã được xóa.",icon:"success",confirmButtonText:"OK",showConfirmButton:!0,confirmButtonColor:"#3085d6"})}catch(a){console.error("Error deleting comment:",a),c.fire({title:"Lỗi!",text:"Đã xảy ra sự cố khi xóa bình luận.",icon:"error"})}}catch(t){console.error("Error showing confirmation dialog:",t)}},D=async(e,t)=>{if(!e){console.log("No reply comment ID provided");return}try{if((await c.fire({title:"Xóa phản hồi bình luận?",text:"Bạn có chắc muốn xóa phản hồi bình luận này không!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Xóa!",cancelButtonText:"Hủy"})).isConfirmed)try{const n=await z(e);if(w(d=>{const i={...d};return i[t]=i[t].filter(s=>s._id!==e),i}),n.success)await c.fire({title:"Đã Xóa!",text:"Phản hồi bình luận đã được xóa.",icon:"success",confirmButtonText:"OK",showConfirmButton:!0,confirmButtonColor:"#3085d6"}),b(h);else throw new Error("Xóa bình luận phản hồi không thành công")}catch(n){console.error("Error deleting reply comment:",n),await c.fire({title:"Lỗi!",text:"Đã xảy ra sự cố khi xóa phản hồi bình luận.",icon:"error"})}}catch(a){console.error("Error showing confirmation dialog:",a)}},T=e=>{y(e),f({text:""})},B=()=>{y(null)},X=async(e,t)=>{e.preventDefault();const a=j[t];if(!a||!t){console.log("Lỗi: Thiếu thông tin id_comment hoặc nội dung bình luận");return}try{const n=await G(t,{content:a});$(),k(t),g(d=>d.map(i=>i._id===t?{...i,replies:[...i.replies||[],n]}:i)),_(),f(d=>({...d,[t]:""}))}catch(n){console.error("Error submitting reply comment:",n)}finally{B()}},L=(e,t)=>{const{value:a}=e.target;f(n=>({...n,[t]:a}))};return o.useEffect(()=>{b(h)},[x,h]),o.useEffect(()=>{l.length>0&&l.forEach(e=>{k(e==null?void 0:e._id)})},[l]),r.jsxs(r.Fragment,{children:[r.jsxs("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[r.jsx("thead",{className:"text-xs text-center text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400",children:r.jsxs("tr",{children:[r.jsx("th",{className:"p-4",children:"Stt"}),r.jsx("th",{className:"p-4",children:"Tên người đánh giá"}),r.jsx("th",{className:"p-4",children:"Đánh giá"}),r.jsx("th",{className:"p-4",children:"Nội dung "}),r.jsx("th",{className:"p-4",children:"Phản hồi "}),r.jsx("th",{className:"p-4 text-center",children:"Chức Năng"})]})}),r.jsx("tbody",{children:(l==null?void 0:l.length)>0?l==null?void 0:l.map((e,t)=>{var a,n,d,i;return r.jsxs(O.Fragment,{children:[r.jsxs("tr",{className:"border-b text-center dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700",children:[r.jsx("td",{className:"px-4 py-3",children:t+1}),r.jsx("td",{className:"px-4 py-3",children:((a=e==null?void 0:e.id_user)==null?void 0:a.name)||"Loading..."}),r.jsx("td",{className:"px-4 py-3 text-sm text-yellow-400",children:Array.from({length:e==null?void 0:e.rating},(s,F)=>r.jsx("span",{children:r.jsx("i",{className:"fa-solid fa-star"})},F))}),r.jsx("td",{className:"px-4 py-3",children:e==null?void 0:e.content}),r.jsx("td",{className:"px-4 py-3",children:(n=p[e==null?void 0:e._id])==null?void 0:n.map(s=>r.jsx("div",{className:"ml-4",children:r.jsx("div",{children:s==null?void 0:s.content})},s==null?void 0:s._id))}),r.jsxs("td",{className:"px-4 py-3 text-center",children:[!(((d=p[e==null?void 0:e._id])==null?void 0:d.length)>0)&&r.jsx("button",{className:"py-2 px-3 flex items-center text-sm font-medium text-center text-white bg-lime-600 rounded-lg hover:bg-lime-500 focus:ring-4 focus:outline-none focus:ring-primary-300 dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800",onClick:()=>T(e==null?void 0:e._id),children:"Trả lời"}),r.jsx("button",{className:"flex items-center border font-medium rounded-lg text-sm px-3 py-2 text-center text-red-700 bg-red-200 hover:text-white border-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:border-red-500 dark:text-red-500 dark:hover:text-white dark:hover:bg-red-600 dark:focus:ring-red-900 mt-4",onClick:()=>E(e==null?void 0:e._id),children:"Xóa bình luận"}),(i=p[e==null?void 0:e._id])==null?void 0:i.map(s=>r.jsx("button",{className:"flex items-center border font-medium rounded-lg text-sm px-3 py-2 text-center text-red-700 bg-red-200 hover:text-white border-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:border-red-500 dark:text-red-500 dark:hover:text-white dark:hover:bg-red-600 dark:focus:ring-red-900 mt-4",onClick:()=>D(s==null?void 0:s._id,e==null?void 0:e._id),children:"Xóa phản hồi"},s==null?void 0:s._id))]})]}),C===(e==null?void 0:e._id)&&r.jsx("tr",{children:r.jsx("td",{colSpan:5,children:r.jsxs("form",{onSubmit:s=>X(s,e._id),children:[r.jsx("input",{type:"text",placeholder:"Trả lời bình luận",className:"w-full p-2 mb-3 border border-gray-300 rounded-md",name:"content",value:j[e==null?void 0:e._id]||"",onChange:s=>L(s,e._id)}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"submit",className:"btn bg-blue-600 text-white py-2 px-4 rounded-lg",children:"Gửi"}),r.jsx("button",{type:"button",className:"btn cancel bg-gray-600 text-white py-2 px-4 rounded-lg",onClick:B,children:"Đóng"})]})]})})})]},t)}):r.jsx("tr",{children:r.jsx("td",{colSpan:5,children:"Không có đánh giá...."})})})]}),l.length>0&&r.jsx(J,{currentPage:h,totalPages:P,onPageChange:R})]})},fe=()=>r.jsxs("div",{children:[r.jsx(V,{items:W.listComments}),r.jsx("div",{className:"mb-4 ml-4 col-span-full xl:mb-2",children:r.jsx("h1",{className:"text-xl font-semibold text-gray-900 sm:text-2xl dark:text-white",children:"Danh sách bình luận"})}),r.jsx("section",{className:"bg-gray-50 dark:bg-gray-900 p-3 sm:p-5 antialiased",children:r.jsx("div",{className:"mb-4 col-span-full xl:mb-2",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 relative shadow-md sm:rounded-lg overflow-hidden",children:[r.jsx("div",{className:"flex flex-col md:flex-row items-stretch md:items-center md:space-x-3 space-y-3 md:space-y-0 justify-between mx-4 py-4 ",children:r.jsx(Y,{})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsx(ee,{})})]})})}),r.jsx(Z,{})]});export{fe as default};
