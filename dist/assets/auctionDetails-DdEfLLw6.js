import{r as l,f as P,g as O,h as d,j as e,J as M,aj as R,ak as z,z as V,al as K,am as q,a3 as A,K as L}from"./index-B8WTsAS6.js";/* empty css                */import{B as u,Q as J}from"./react-toastify.esm-BnAFxftJ.js";/* empty css                      */import{N as Q}from"./react-number-format.es-D6o-XRFQ.js";import{s as U,p as X,v as $}from"./vi-xLdnlTze.js";import{f as F}from"./format-bLcKm-ZP.js";import"./clsx-B-dksMZM.js";import"./constants-B1QkQIQl.js";const Y=({productId:c})=>{const[x,g]=l.useState(!1),[v,i]=l.useState(void 0),N=P(),m=O(),n=d(t=>{var o;return(o=t.auth.profile.profile)==null?void 0:o._id}),{bid:a}=d(t=>t.randBidPrice),f=d(t=>t.bidding.status),w=d(t=>t.auth.login.isLoggedIn),p=d(t=>t.auth.login.error),h=d(t=>t.auth.login.roles);l.useEffect(()=>{w?h&&h.length>0?h.some(t=>t.name==="user"):(u.success("Bạn là Admin - Tài khoản không được tiến hành đấu giá !!"),setTimeout(()=>{},2e3)):p&&m("/login-error")},[w,h,p,m]);const I=()=>{g(!x),x||N(R(c))},b=()=>g(!1),k=t=>{t!==void 0?(i(t),T(t)):u.error("Lỗi xác nhận giá thầu. Làm ơn thử lại")},j=t=>i(t.floatValue),T=t=>{if(!n){u.error("Bạn chưa đăng nhập");return}const o=t??v;if(o===void 0){u.error("Giá thầu là bắt buộc");return}const y=(a==null?void 0:a.minBid)??0,B=y*1.07;o>=y&&o<=B&&n?N(z({productId:c,userId:n,bidAmount:o})).then(()=>{U.emitCreateBidding(c,{userId:n,bidAmount:o}),u.success("Đặt thầu thành công!",{onClose:()=>{m("/viewBids")}})}).catch(s=>{u.error(`Error: ${s.message}`)}):u.error(`Giá thầu phải lớn hơn hoặc bằng ${M.format(y,{code:"VND",symbol:""})}
        và không vượt quá ${M.format(B,{code:"VND",symbol:""})}.`)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{id:"open-modal",style:{width:250},className:"block text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5",type:"button",onClick:I,children:"Đặt giá thầu"}),x&&e.jsx("div",{id:"default-modal",tabIndex:-1,"aria-hidden":"true",className:"fixed inset-0 flex items-center justify-center z-50 bg-transparent bg-opacity-10",children:e.jsxs("div",{className:"relative w-90 p-4 bg-white rounded-lg shadow dark:bg-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b rounded-t dark:border-gray-600",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Đặt thầu"}),e.jsxs("button",{type:"button",className:"text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white",onClick:b,children:[e.jsx("svg",{className:"w-3 h-3","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14",children:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"})}),e.jsx("span",{className:"sr-only",children:"Đóng"})]})]}),e.jsxs("div",{className:"relative p-5 text-center bg-white rounded-lg shadow dark:bg-gray-800 max-w-3xl mx-auto",children:[e.jsx("div",{className:"flex justify-center items-center space-x-8",children:[{label:"Giá thấp (đ) ",value:a==null?void 0:a.minBid},{label:"Giá trung bình (đ)",value:a==null?void 0:a.midBid},{label:"Giá cao (đ) ",value:((a==null?void 0:a.minBid)??0)*1.07}].map((t,o)=>e.jsxs("div",{className:"flex flex-col items-center w-1/3",children:[e.jsx("label",{className:"text-sm text-gray-500 dark:text-gray-300 mb-1",children:t.label}),e.jsx("button",{type:"button",className:"w-full py-3 px-6 text-sm font-medium text-center text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-500 dark:hover:bg-blue-600 dark:focus:ring-blue-900",onClick:()=>k(t.value),children:M.format(t.value??0,{code:"VND",symbol:""})})]},o))}),e.jsx("br",{}),e.jsx("hr",{className:"mb-4 border-gray-300 dark:border-gray-600"}),e.jsx("br",{}),e.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-4 w-full",children:[e.jsx(Q,{placeholder:"Nhập thầu",value:v,onValueChange:j,thousandSeparator:",",allowNegative:!1,className:"w-2/3 py-3 px-6 text-sm font-medium text-gray-500 bg-white rounded-lg border border-gray-200 focus:ring-4 focus:outline-none focus:ring-primary-300 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-500 dark:focus:ring-gray-600"}),e.jsx("button",{type:"button",className:"w-1/3 py-3 px-6 text-sm font-medium text-center text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-500 dark:hover:bg-blue-600 dark:focus:ring-blue-900",onClick:()=>T(),children:"Xem thầu"})]}),f==="loading"&&e.jsx("p",{children:"Loading..."})]})]})}),e.jsx(J,{})]})};function Z(c){return M.format(c,{code:"VND",symbol:""})}const ee=()=>{const[c,x]=l.useState(""),[g,v]=l.useState(0),{productId:i}=V(),N=d(r=>{var s;return(s=r.auth.profile.profile)==null?void 0:s._id}),m=P(),[n,a]=l.useState(null),{productTimeTrack:f,loading:w,error:p}=d(r=>r.productByTimeTrack),[h,I]=l.useState(""),b=d(r=>r.watchlist.items),[k,j]=l.useState(!1),T=async r=>{if(N&&i)try{let s;k?(s=await m(A({productId:i,variantId:r})).unwrap(),A.fulfilled.match(s)?j(!1):console.log(s)):(s=await m(L({productId:i})).unwrap(),L.fulfilled.match(s)?j(!0):console.log(s))}catch(s){s instanceof Error&&console.log(s.message)}else console.log("User ID or Product ID is missing")},t=r=>{v(r)};l.useEffect(()=>{i&&m(K(i)).unwrap().then(r=>{r!=null&&r.data?a(r.data):a(null)}).catch(r=>console.error("Error fetching product:",r))},[i,m]),l.useEffect(()=>{if(n!=null&&n.endTime){const r=new Date(n.endTime),s=()=>{x(F(new Date,"HH:mm:ss 'Ngày' EEEE, d MMMM 'năm' yyyy  ",{locale:$})),I(o(r))};s();const E=setInterval(s,1e3);return()=>clearInterval(E)}},[n]),l.useEffect(()=>{if(a(f?f.data:null),Array.isArray(b)){const r=b.some(s=>s.product&&s.product._id===i);j(r)}},[f,b,i]);const o=r=>{const s=new Date,E=r.getTime()-s.getTime();if(E<=0)return"Hết thời gian";const C=Math.floor(E/1e3),S=Math.floor(C/60),D=Math.floor(S/60),_=Math.floor(D/24)%30,G=D%24,H=S%60,W=C%60;return` ${_} ngày ${G} giờ ${H} phút ${W} giây`};if(w)return e.jsx("div",{children:"Loading..."});if(p)return e.jsxs("div",{children:["Error: ",p]});if(!n)return e.jsx("p",{children:"Loading..."});const y=n.endTime?F(X(n.endTime),"HH:mm:ss 'Ngày' EEEE, d MMMM 'năm' yyyy",{locale:$}):"",B=n.product_price_unit??0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container py-4 flex items-center gap-3",children:[e.jsx("a",{href:"/",className:"text-primary text-base flex items-center",children:e.jsx("span",{className:"ml-2",children:"Sản phẩm"})}),e.jsx("span",{className:"text-sm text-gray-400 mx-2",children:e.jsx("i",{className:"fa-solid fa-chevron-right"})}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Chi tiết sản phẩm"})]}),e.jsxs("div",{className:"container grid grid-cols-1 md:grid-cols-2 gap-6 p-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-center items-center mb-4",children:n.images&&n.images[g]?e.jsx("img",{src:n.images[g].url,alt:"Ảnh chính",className:"w-full h-auto object-cover",style:{height:430}}):e.jsx("p",{children:"No image available"})}),e.jsx("div",{className:"flex justify-center gap-4",children:(n.images||[]).slice(0,4).map((r,s)=>e.jsx("img",{src:r.url,alt:`Image ${s}`,className:`w-20 h-16 object-cover cursor-pointer \r
                    border border-gray-300 rounded`,onClick:()=>t(s)},s))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-semibold uppercase mb-2",children:n.product_name}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("p",{className:"text-gray-800 font-roboto font-bold",children:e.jsxs("span",{children:["Thời gian hiện tại: ",c]})}),e.jsx("p",{className:"text-gray-800 font-roboto font-bold ",children:e.jsxs("span",{children:["Thời gian kết thúc: ",y]})}),e.jsx("p",{className:"text-gray-800 font-roboto font-bold ",children:e.jsxs("span",{children:["Giờ còn lại: ",h]})}),e.jsx("p",{className:"text-yellow-400 font-roboto font-bold text-xl ",children:e.jsxs("span",{children:["Điều kiện: ",n.product_condition]})})]}),e.jsx("div",{className:"flex items-baseline mb-4 space-x-2 font-roboto",children:e.jsxs("p",{className:"text-2xl text-primary font-semibold",children:[Z(B),"đ"]})}),e.jsx("div",{className:"pt-2",children:e.jsx("div",{className:"flex flex-wrap gap-2"})}),e.jsxs("div",{className:"mt-6 flex gap-3 border-t border-gray-200 pt-5",children:[i&&e.jsx(Y,{productId:i}),e.jsxs("button",{onClick:()=>T(),className:`flex items-center space-x-2 bg-gray-200\r
               text-white px-4 py-2 font-medium rounded uppercase hover:bg-gray-300 transition`,children:[e.jsx("i",{className:`fas fa-heart ${k?"text-red-500":"text-gray-500"}`}),e.jsx("span",{className:"ml-2 text-slate-950",children:"Yêu thích"})]})]})]})]}),e.jsxs("div",{className:"container pb-16",children:[e.jsx("h3",{className:"border-b border-gray-200 font-roboto text-gray-800 pb-3 font-medium text-xl",children:"Thông tin chi tiết"}),e.jsx("div",{className:"pt-6",children:e.jsx("table",{className:"table-auto border-collapse w-full text-left text-gray-600 text-sm",children:e.jsxs("li",{children:[e.jsx("strong",{children:"Khối lượng:"})," ",e.jsxs("span",{children:[n.weight_g," g"]})]})})})]}),e.jsx("div",{className:"text-left",children:e.jsx("h2",{className:"text-3xl font-bold leading-tight text-gray-900 sm:text-3xl xl:text-4xl uppercase py-10 px-10",children:"Sản phẩm dành cho bạn"})}),e.jsx(q,{})]})},me=()=>{const{productId:c}=V();return c?e.jsx(e.Fragment,{children:e.jsx(ee,{productId:c})}):e.jsx("p",{children:"Product ID is missing!"})};export{me as default};
