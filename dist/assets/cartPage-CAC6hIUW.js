import{f as H,g as F,h as j,r as g,j as t,an as E,k as A,ao as X,ap as G}from"./index-B8WTsAS6.js";import{B as o,Q as R}from"./react-toastify.esm-BnAFxftJ.js";/* empty css                      */import{c as D}from"./chunk-KBN3H6OQ-BYj_qRg-.js";import{b as w}from"./chunk-DBLREEYE-KYxkDfWC.js";import"./clsx-B-dksMZM.js";import"./focusSafely-7dc_zii7.js";import"./useEffectEvent-Cg1JSw20.js";import"./useFocusWithin-Cnv4cfRz.js";import"./chunk-N2KXC5ZE-mxrXGXiM.js";import"./chunk-XHQUSKIE-BwnSvnTo.js";import"./index-DiNnCp_7.js";import"./_class_private_field_set-DiTYLpP0.js";import"./chunk-CAFRINWI-BTDo8zfp.js";import"./useFocusable-BgsBLUcz.js";import"./filterDOMProps-B3AneKiX.js";import"./useFocus-CiKVCmpT.js";import"./useFormValidationState-Ds8IGnmn.js";import"./useFormReset-BlmLPiDA.js";import"./VisuallyHidden-D5xcTfY7.js";import"./chunk-CIZQCQPA-BQKhqm3c.js";import"./chunk-BZCSOIUI-ECjOxws-.js";import"./chunk-6NL67ZRH-ST4yRtyp.js";import"./chunk-MNNRULGA-Ck-UmubQ.js";import"./features-animation-BrpZblPW.js";import"./chunk-TDOFO53L-BhVz0FjF.js";const U=()=>{const l=H(),Q=F(),c=j(e=>e.cart.carts),$=j(e=>e.cart.status),_=j(e=>e.cart.error),[k,m]=g.useState(!1),I=j(e=>{var r;return((r=e.auth.profile)==null?void 0:r.roles)||[]}),[u,h]=g.useState({}),[C,M]=g.useState(0);g.useEffect(()=>{const e={};Array.isArray(c)?(c.forEach(r=>{Array.isArray(r.items)?r.items.forEach(a=>{e[a.product._id]=a.quantity}):console.warn("Cart items are not in an array format:",r.items)}),h(e)):console.error("Expected carts to be an array but received:",c)},[c]),g.useEffect(()=>{const e=c.reduce((r,a)=>r+a.items.reduce((s,n)=>{if(n.isSelected){const i=u[n.product._id]||n.quantity;return s+(n.productVariant.variant_price||0)*i}return s},0),0);M(e)},[c,u]);const P=async(e,r)=>{const a=r.items.map(s=>({productId:s.product._id,variantId:s.productVariant._id,isSelected:!s.isSelected}));o.dismiss(),m(!0);try{await l(E({productId:e,items:a})).unwrap(),await l(A())}catch(s){console.error("Lỗi khi chọn giỏ hàng:",s),o.error("Lỗi khi cập nhật giỏ hàng.")}finally{m(!1)}},L=async(e,r)=>{m(!0);try{await l(E({selectAll:e,cartId:r})).unwrap(),await l(A())}catch{o.error("Lỗi khi chọn tất cả sản phẩm.")}finally{m(!1)}},N=async(e,r,a)=>{const s=c.flatMap(i=>i.items).find(i=>i.product._id===r);if(s){const i=s.inventory.quantityShelf,d=Math.min(99,i);if(a>d){o.dismiss(),o.error(`Số lượng không được vượt quá ${d} sản phẩm có sẵn.`),h(b=>({...b,[r]:s.quantity}));return}}const n=Math.max(1,a);try{const i=s==null?void 0:s.productVariant._id;if(!i)throw new Error("Thiếu biến thể sản phẩm.");await l(X({cartId:e,itemId:r,variantId:i,quantity:n})).unwrap(),h(d=>({...d,[r]:n}))}catch(i){console.error("Failed to update quantity:",i),o.error("Cập nhật số lượng thất bại.")}},T=(e,r,a)=>{const s=Math.max(1,a-1);N(e,r,s)},z=(e,r,a)=>{N(e,r,a+1)},B=()=>{Q(`/checkout/${c[0]._id}`,{})},S=async(e,r,a)=>{m(!0);try{await l(G({cartId:e,productId:r,productVariantId:a})).unwrap(),o.success("Sản phẩm đã được xóa khỏi giỏ hàng.")}catch{o.error("Xóa sản phẩm thất bại.")}finally{m(!1)}};if($==="failed")return o.error(`Error: ${_}`),t.jsxs("p",{children:["Error: ",_]});if(!Array.isArray(c))return t.jsx("p",{children:"Dữ liệu giỏ hàng không hợp lệ"});const y=new Map,f=[];return c.filter(e=>e!=null&&Array.isArray(e.items)).forEach(e=>{e.items.forEach(r=>{const a=`${r.product._id}-${r.productVariant._id}`;if(!y.has(a))y.set(a,{...e,items:[r]});else{const s=y.get(a),n=[...s.items],i=n.findIndex(d=>d.product._id===r.product._id&&d.productVariant._id===r.productVariant._id);i!==-1?n[i]={...n[i],quantity:n[i].quantity+r.quantity,totalItemPrice:n[i].totalItemPrice+r.productVariant.variant_price*r.quantity}:n.push({...r,totalItemPrice:r.productVariant.variant_price*r.quantity}),s.items=n}})}),y.forEach(e=>{f.push(e)}),Array.isArray(c)?t.jsxs("div",{className:"min-h-[calc(71vh-10rem)] container lg:col-span-8 border border-gray-200 p-4 rounded-lg shadow-sm bg-white mb-16 mt-16",children:[t.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"md:col-span-2 p-4 rounded-md",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Giỏ hàng"}),t.jsx("hr",{className:"border-gray-300 mt-4 mb-8"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(D,{id:"checkbox-all-orders",isSelected:c.every(e=>e.items.every(r=>r.isSelected)),onChange:e=>L(e.target.checked,c[0]._id),size:"sm",color:"primary",className:"mr-2"}),t.jsx("label",{htmlFor:"checkbox-all-orders",className:"ml-2",children:"Chọn tất cả"}),t.jsxs(w,{onClick:()=>S(c[0]._id),disabled:k,className:"btn btn-danger",children:[t.jsx("i",{className:"iconify mdi--delete w-5 h-5 text-red-600 transition duration-75 dark:text-red-400 group-hover:text-red-800 dark:group-hover:text-white "}),"Xóa toàn bộ"]})]}),t.jsx("div",{className:"space-y-4 mt-4",children:f.map(e=>{var r,a,s,n,i,d,b,V,q;return t.jsx("div",{className:"bg-white p-4 rounded-md shadow-sm",children:t.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-4 w-full md:w-3/4",children:[t.jsx(D,{id:`checkbox-${e._id}`,isSelected:e.items.every(p=>p.isSelected),onChange:()=>P(e._id,e),size:"sm",color:"primary",className:"mr-2"}),t.jsx("div",{className:"w-24 h-24 shrink-0 border bg-white p-2 rounded-md",children:t.jsx("img",{src:((i=(n=(s=(a=(r=e.items[0])==null?void 0:r.productVariant)==null?void 0:a.image)==null?void 0:s[0])==null?void 0:n.image)==null?void 0:i[0])||"https://img.lovepik.com/free-png/20220126/lovepik-404-page-not-accessible-png-image_401803272_wh1200.png",alt:`product ${((b=(d=e.items[0])==null?void 0:d.productVariant)==null?void 0:b.variant_name)||"Unknown"}`,className:"w-full h-full object-contain"})}),t.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[t.jsx("h3",{className:"text-base font-bold text-gray-800",children:e.items[0].productVariant.variant_name}),t.jsx("h6",{onClick:()=>S(e._id,e.items[0].product._id,e.items[0].productVariant._id),className:`text-xs text-red-500 cursor-pointer mt-0.5 ${k?"opacity-50":""}`,children:"Xóa"}),t.jsxs("div",{className:"flex flex-wrap gap-4 mt-4",children:[t.jsx("button",{type:"button",className:"flex items-center px-2.5 py-1.5 border border-gray-300 text-gray-800 text-xs outline-none bg-transparent rounded-md",children:t.jsx("h5",{className:"text-gray-800 font-semibold",children:(V=e.items[0].productVariant.ram)==null?void 0:V.name})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",className:"flex items-center justify-center w-8 h-8 border border-gray-300 text-gray-800 text-xs outline-none bg-transparent rounded-md",onClick:()=>T(e._id,e.items[0].product._id,u[e.items[0].product._id]||e.items[0].quantity),children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-3 fill-current",viewBox:"0 0 124 124",children:t.jsx("path",{d:"M112 50H12c-6.6 0-10.8-1.8-10.8-6.5S5.4 37 12 37h100c6.6 0 10.8 1.8 10.8 6.5S118.6 50 112 50z"})})}),t.jsx("input",{type:"text",className:"w-12 text-center border border-gray-300 text-gray-800 text-xs rounded-md",value:u[e.items[0].product._id]||e.items[0].quantity,onChange:p=>{const x=Number(p.target.value);!isNaN(x)&&x>=1&&x<=99?h(v=>({...v,[e.items[0].product._id]:x})):x>99&&(o.dismiss(),o.error("Số lượng không được vượt quá 99."),h(v=>({...v,[e.items[0].product._id]:99})))},onBlur:p=>N(e._id,e.items[0].product._id,Number(p.target.value))}),t.jsx("button",{type:"button",className:"flex items-center justify-center w-8 h-8 border border-gray-300 text-gray-800 text-xs outline-none bg-transparent rounded-md",onClick:()=>z(e._id,e.items[0].product._id,u[e.items[0].product._id]||e.items[0].quantity),children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-3 fill-current",viewBox:"0 0 42 42",children:t.jsx("path",{d:"M37.059 16H26V4.941C26 2.224 23.718 0 21 0s-5 2.224-5 4.941V16H4.941C2.224 16 0 18.282 0 21s2.224 5 4.941 5H16v11.059C16 39.776 18.282 42 21 42s5-2.224 5-4.941V26h11.059C39.776 26 42 23.718 42 21s-2.224-5-4.941-5z"})})})]})]})]})]}),t.jsx("div",{className:"ml-auto mt-4 md:mt-0",children:t.jsx("h4",{className:"text-base font-bold text-gray-800",children:e.items.length>0&&((q=e.items[0].productVariant)!=null&&q.variant_price)?e.items[0].productVariant.variant_price.toLocaleString("vi-VN",{style:"currency",currency:"VND"}):"Giá chưa được cập nhật"})})]})},`${e._id}-${e.items[0].product._id}`)})})]}),t.jsxs("div",{className:"p-4 rounded-md bg-gray-50",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Tổng cộng"}),t.jsx("hr",{className:"border-gray-300 mt-4 mb-8"}),t.jsx("h3",{className:"text-gray-800",children:"Danh sách sản phẩm:"}),f.map(e=>t.jsx("div",{className:"flex justify-between mt-2",children:t.jsxs("span",{className:"text-gray-800",children:[e.items[0].product.product_name," x"," ",u[e.items[0].product._id]||e.items[0].quantity]})},e._id)),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("p",{className:"text-gray-800",children:"Tạm tính:"}),t.jsx("p",{className:"font-bold text-gray-800",children:C.toLocaleString("vi-VN",{style:"currency",currency:"VND"})})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("p",{className:"text-gray-800",children:"Phí vận chuyển:"}),t.jsx("p",{className:"font-bold text-gray-800",children:"Miễn phí giao hàng"})]})]}),t.jsx("hr",{className:"border-gray-300 mt-4 mb-8"}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("p",{className:"text-lg font-bold text-gray-800",children:"Tổng cộng:"}),t.jsx("p",{className:"text-xl font-bold text-red-600",children:C.toLocaleString("vi-VN",{style:"currency",currency:"VND"})})]}),t.jsxs("div",{className:"mt-8 space-y-2",children:[t.jsx(w,{onClick:B,className:"w-full bg-blue-600 font-semibold text-white hover:bg-primary-dark focus:ring-primary-light",isDisabled:I.includes("admin")||!f.some(e=>e.items.some(r=>r.isSelected)),children:"Thanh toán"}),t.jsx(w,{className:"w-full bg-blue-600 font-semibold text-white hover:bg-primary-dark focus:ring-primary-light",children:"Tiếp tục mua sắm"})]})]})]}),t.jsx(R,{})]}):t.jsx("p",{children:"Dữ liệu giỏ hàng không hợp lệ"})},Ne=()=>t.jsx(t.Fragment,{children:t.jsx(U,{})});export{Ne as default};
