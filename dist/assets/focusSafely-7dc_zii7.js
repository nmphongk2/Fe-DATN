import{$ as h}from"./useEffectEvent-Cg1JSw20.js";import{r as u}from"./index-B8WTsAS6.js";import{g as T,$ as y}from"./useFocusWithin-Cnv4cfRz.js";function g(e){if(w())e.focus({preventScroll:!0});else{let t=C(e);e.focus(),x(t)}}let b=null;function w(){if(b==null){b=!1;try{document.createElement("div").focus({get preventScroll(){return b=!0,!0}})}catch{}}return b}function C(e){let t=e.parentNode,n=[],r=document.scrollingElement||document.documentElement;for(;t instanceof HTMLElement&&t!==r;)(t.offsetHeight<t.scrollHeight||t.offsetWidth<t.scrollWidth)&&n.push({element:t,scrollTop:t.scrollTop,scrollLeft:t.scrollLeft}),t=t.parentNode;return r instanceof HTMLElement&&n.push({element:r,scrollTop:r.scrollTop,scrollLeft:r.scrollLeft}),n}function x(e){for(let{element:t,scrollTop:n,scrollLeft:r}of e)t.scrollTop=n,t.scrollLeft=r}let a=new Map,p=new Set;function v(){if(typeof window>"u")return;function e(r){return"propertyName"in r}let t=r=>{if(!e(r)||!r.target)return;let o=a.get(r.target);o||(o=new Set,a.set(r.target,o),r.target.addEventListener("transitioncancel",n,{once:!0})),o.add(r.propertyName)},n=r=>{if(!e(r)||!r.target)return;let o=a.get(r.target);if(o&&(o.delete(r.propertyName),o.size===0&&(r.target.removeEventListener("transitioncancel",n),a.delete(r.target)),a.size===0)){for(let i of p)i();p.clear()}};document.body.addEventListener("transitionrun",t),document.body.addEventListener("transitionend",n)}typeof document<"u"&&(document.readyState!=="loading"?v():document.addEventListener("DOMContentLoaded",v));function N(e){requestAnimationFrame(()=>{a.size===0?e():p.add(e)})}function V(e,t){h(()=>{if(e&&e.ref&&t)return e.ref.current=t.current,()=>{e.ref&&(e.ref.current=null)}})}function W(e,t,n){let[r,o]=u.useState(e||t),i=u.useRef(e!==void 0),l=e!==void 0;u.useEffect(()=>{let c=i.current;c!==l&&console.warn(`WARN: A component changed from ${c?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}.`),i.current=l},[l]);let s=l?e:r,L=u.useCallback((c,...$)=>{let m=(f,...d)=>{n&&(Object.is(s,f)||n(f,...d)),l||(s=f)};typeof c=="function"?(console.warn("We can not support a function callback. See Github Issues for details https://github.com/adobe/react-spectrum/issues/2320"),o((d,...S)=>{let E=c(l?s:d,...S);return m(E,...$),l?d:E})):(l||o(c),m(c,...$))},[l,s,n]);return[s,L]}function k(e){const t=T(e);if(y()==="virtual"){let n=t.activeElement;N(()=>{t.activeElement===n&&e.isConnected&&g(e)})}else g(e)}export{W as $,k as a,g as b,V as c,N as d};
